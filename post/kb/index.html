<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  
  <meta name="author" content="">

  
  
  <meta name="description" content="2023
2023-08 August
2023-08-21 Monday



PlantUML and GraphViz (DOT)
 


PlantUML
It is a tool (Java library/package) that helps one to create UML diagrams with ease.
For the full details of it, one should look at https://plantuml.com/.
The basic idea is that you write the diagram you need in plain text, and then using java &#43; plantuml.jar (downloaded from the website above), generate a nice diagram.
Your steps


Setup java on your machine">
  

  
  <link rel="icon" href="https://codicles.org/favicon.ico">

  
  
  <meta name="keywords" content=" Chronicles  emacs  programming  code ">
  

  
  

  
  <meta property="og:url" content="https://codicles.org/post/kb/">
  <meta property="og:site_name" content="Code Chronicles (mostly)">
  <meta property="og:title" content="Code Chronicles (mostly)">
  <meta property="og:description" content="2023 2023-08 August 2023-08-21 Monday PlantUML and GraphViz (DOT)
PlantUML
It is a tool (Java library/package) that helps one to create UML diagrams with ease.
For the full details of it, one should look at https://plantuml.com/.
The basic idea is that you write the diagram you need in plain text, and then using java &#43; plantuml.jar (downloaded from the website above), generate a nice diagram.
Your steps
Setup java on your machine">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2023-12-01T16:21:49+01:00">
    <meta property="article:modified_time" content="2023-12-01T16:21:49+01:00">


  
  <link rel="canonical" href="https://codicles.org/post/kb/">

  
  
  
  <meta itemprop="name" content="Code Chronicles (mostly)">
  <meta itemprop="description" content="2023 2023-08 August 2023-08-21 Monday PlantUML and GraphViz (DOT)
PlantUML
It is a tool (Java library/package) that helps one to create UML diagrams with ease.
For the full details of it, one should look at https://plantuml.com/.
The basic idea is that you write the diagram you need in plain text, and then using java &#43; plantuml.jar (downloaded from the website above), generate a nice diagram.
Your steps
Setup java on your machine">
  <meta itemprop="datePublished" content="2023-12-01T16:21:49+01:00">
  <meta itemprop="dateModified" content="2023-12-01T16:21:49+01:00">
  <meta itemprop="wordCount" content="871">

  
  <link media="screen" rel="stylesheet" href='https://codicles.org/css/common.css'>
  <link media="screen" rel="stylesheet" href='https://codicles.org/css/content.css'>

  
  
  <title> - Code Chronicles (mostly)</title>
  

  
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Code Chronicles (mostly)">
  <meta name="twitter:description" content="2023 2023-08 August 2023-08-21 Monday PlantUML and GraphViz (DOT)
PlantUML
It is a tool (Java library/package) that helps one to create UML diagrams with ease.
For the full details of it, one should look at https://plantuml.com/.
The basic idea is that you write the diagram you need in plain text, and then using java &#43; plantuml.jar (downloaded from the website above), generate a nice diagram.
Your steps
Setup java on your machine">


  
<link rel="stylesheet" href='https://codicles.org/css/single.css'>

</head>

<body>
  <div id="wrapper">
    <header id="header">
  <h1>
    <a href="https://codicles.org/">Code Chronicles (mostly)</a>
  </h1>

  <nav>
    
    <span class="nav-bar-item">
      <a class="link" href="/">Home</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/post/">Archives</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/about/">About</a>
    </span>
    
  </nav>
</header>

    
<main id="main" class="post">
  
  
  <h1></h1>
  
  
  <article class="content">
    
    <h2 id="2023">2023</h2>
<h3 id="2023-08-august">2023-08 August</h3>
<h4 id="2023-08-21-monday">2023-08-21 Monday</h4>
<!--list-separator-->
<ul>
<li>
<p>PlantUML and GraphViz (DOT)</p>
 <!--list-separator-->
<ul>
<li>
<p>PlantUML</p>
<p>It is a tool (Java library/package) that helps one to create UML diagrams with ease.</p>
<p>For the full details of it, one should look at <a href="https://plantuml.com/">https://plantuml.com/</a>.</p>
<p>The basic idea is that you write the diagram you need in plain text, and then using java + plantuml.jar (downloaded from the website above), generate a nice diagram.</p>
<p>Your steps</p>
<ol>
<li>
<p>Setup java on your machine</p>
</li>
<li>
<p>Download PlantUML.jar</p>
</li>
<li>
<p>Create your text file for the diagram (see example here)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>@startuml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>title Your title
</span></span><span style="display:flex;"><span>center footer Your footer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>skinparam classFontName Georgia
</span></span><span style="display:flex;"><span>skinparam roundcorner 20
</span></span><span style="display:flex;"><span>skinparam defaultFontName Georgia
</span></span><span style="display:flex;"><span>skinparam dpi 160
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>participant &#34;Participant Fellow&#34; as participant
</span></span><span style="display:flex;"><span>actor       Actor       as actor
</span></span><span style="display:flex;"><span>boundary    Boundary    as boundary
</span></span><span style="display:flex;"><span>control     Control     as control
</span></span><span style="display:flex;"><span>entity      Entity      as entity
</span></span><span style="display:flex;"><span>database    Database    as db
</span></span><span style="display:flex;"><span>collections Collections as colls
</span></span><span style="display:flex;"><span>queue       Queue       as q
</span></span><span style="display:flex;"><span>participant  -&gt; actor : To actor
</span></span><span style="display:flex;"><span>participant  -&gt; boundary : To boundary
</span></span><span style="display:flex;"><span>participant  -&gt; control : To control
</span></span><span style="display:flex;"><span>participant  -&gt; entity : To entity
</span></span><span style="display:flex;"><span>participant  -&gt; db : To database
</span></span><span style="display:flex;"><span>participant  -&gt; colls : To collections
</span></span><span style="display:flex;"><span>participant  -&gt; q: To queue
</span></span><span style="display:flex;"><span>boundary -&gt; actor : To actor
</span></span><span style="display:flex;"><span>control -&gt; boundary : To boundary
</span></span><span style="display:flex;"><span>db -&gt; control : To control
</span></span><span style="display:flex;"><span>actor -&gt; entity : To entity
</span></span><span style="display:flex;"><span>entity -&gt; db : To database
</span></span><span style="display:flex;"><span>q -&gt; colls : To collections
</span></span><span style="display:flex;"><span>colls -&gt; q: To queue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@enduml
</span></span></code></pre></div></li>
<li>
<p>Compile</p>
<pre tabindex="0"><code class="language-nil" data-lang="nil">export JAVA_HOME=$(/usr/libexec/java_home) # set the JAVA_HOME variable
java -jar path/to/plantuml.jar -verbose &lt;inputfile&gt;
</code></pre></li>
<li>
<p>You will have the output as png in the folder.</p>
<figure><img src="/ox-hugo/sample-plantuml-output.png">
            </figure>

</li>
</ol>
</li>
</ul>
 <!--list-separator-->
<ul>
<li>
<p>DOT / Grapviz</p>
<p>For this, you need to install graphviz on your system and should have the command <code>dot</code> available.</p>
<p>Installation is straight forward in *nix machines. See <a href="https://graphviz.org/">https://graphviz.org/</a></p>
<ol>
<li>
<p>Install Graphviz, have Dot</p>
</li>
<li>
<p>Create input file (example)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>digraph name  {
</span></span><span style="display:flex;"><span>        Sample -&gt; Diagram -&gt; Workflow;
</span></span><span style="display:flex;"><span>        Test -&gt; Diagram;
</span></span><span style="display:flex;"><span>        Sample -&gt; Workflow
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<p>Run command <code>dot -Tpng input.file &gt; output.png</code></p>
</li>
<li>
<p>You have the output ready.</p>
<figure><img src="/ox-hugo/pf-workflow.png">
            </figure>

</li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="2023-09-september">2023-09 September</h3>
<h4 id="2023-09-04-monday">2023-09-04 Monday</h4>
<!--list-separator-->
<ul>
<li>
<p>Marshaling magic in Golang</p>
<p>If you want to customise the json representation of a field in a golang struct, you can just add some custome JSON tag</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">type</span> OneStruct <span style="color:#a2f;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>     PublicField <span style="color:#b44">`json&#34;public_field&#34;`</span>
</span></span><span style="display:flex;"><span>     AnotherField <span style="color:#b44">`json:&#34;camelCasedInJSON&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This won&rsquo;t help you expose private fields. If you want to expose them, you need to override the <code>MarshalJSON</code> method of the struct.
See the example below</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">import</span> (
</span></span><span style="display:flex;"><span>        <span style="color:#b44">&#34;encoding/json&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#b44">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">type</span> MyStruct <span style="color:#a2f;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>        UpperCase <span style="color:#0b0;font-weight:bold">string</span>
</span></span><span style="display:flex;"><span>        lowerCase <span style="color:#0b0;font-weight:bold">string</span> <span style="color:#080;font-style:italic">// NOTE: This field is not exported, and will not be in the json</span>
</span></span><span style="display:flex;"><span>        secret    <span style="color:#0b0;font-weight:bold">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">// createStruct creates a struct with an exported and an unexported field.</span>
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">func</span> <span style="color:#00a000">createStruct</span>() <span style="color:#666">*</span>MyStruct {
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#666">&amp;</span>MyStruct{
</span></span><span style="display:flex;"><span>                UpperCase: <span style="color:#b44">&#34;UPPER&#34;</span>,
</span></span><span style="display:flex;"><span>                lowerCase: <span style="color:#b44">&#34;lower&#34;</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">// we implement the Marshaler interface for our struct.</span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">// This means that when we call json.Marshal on our struct, this</span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">// method will be called.</span>
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">func</span> (s <span style="color:#666">*</span>MyStruct) <span style="color:#00a000">MarshalJSON</span>() ([]<span style="color:#0b0;font-weight:bold">byte</span>, <span style="color:#0b0;font-weight:bold">error</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#080;font-style:italic">// we create a new &#34;marshalable&#34; struct with the fields we want to</span>
</span></span><span style="display:flex;"><span>        <span style="color:#080;font-style:italic">// export. We do not need to create a new type for this, we can</span>
</span></span><span style="display:flex;"><span>        <span style="color:#080;font-style:italic">// just use a struct literal.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        marshalable <span style="color:#666">:=</span> <span style="color:#a2f;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>                UpperCase <span style="color:#0b0;font-weight:bold">string</span> <span style="color:#b44">`json:&#34;upperCase&#34;`</span>
</span></span><span style="display:flex;"><span>                LowerCase <span style="color:#0b0;font-weight:bold">string</span> <span style="color:#b44">`json:&#34;lower_case&#34;`</span>
</span></span><span style="display:flex;"><span>        }{
</span></span><span style="display:flex;"><span>                <span style="color:#080;font-style:italic">// NOTE: The order of the keys is not guaranteed.</span>
</span></span><span style="display:flex;"><span>                UpperCase: s.UpperCase,
</span></span><span style="display:flex;"><span>                LowerCase: s.lowerCase,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">return</span> json.<span style="color:#00a000">Marshal</span>(marshalable)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">func</span> <span style="color:#00a000">main</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ourStruct <span style="color:#666">:=</span> <span style="color:#00a000">createStruct</span>()
</span></span><span style="display:flex;"><span>        json, err <span style="color:#666">:=</span> json.<span style="color:#00a000">Marshal</span>(ourStruct)
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span> err <span style="color:#666">!=</span> <span style="color:#a2f;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>                fmt.<span style="color:#00a000">Println</span>(err.<span style="color:#00a000">Error</span>())
</span></span><span style="display:flex;"><span>                <span style="color:#a2f;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        fmt.<span style="color:#00a000">Println</span>(<span style="color:#a2f">string</span>(json))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>&ndash; sillyfellow @ <span class="timestamp-wrapper"><span class="timestamp">[2023-09-04 Mon 11:17]</span></span></p>
</li>
</ul>
<h3 id="2023-12-december">2023-12 December</h3>
<h4 id="2023-12-01-friday">2023-12-01 Friday</h4>
<!--list-separator-->
<ul>
<li>
<p>Refresh token (access token)</p>
<ul>
<li>Do not use JWT (Just DON&rsquo;T)</li>
<li>Always have a sessions table
<ul>
<li>Which belongs to the USER
<ul>
<li>i.e., sessions table has a user_id column</li>
</ul>
</li>
<li>Have access_token and refresh_token
<ul>
<li>ideally as varchar(256), not text</li>
<li>do not allow them to grow</li>
<li>security shall be mostly based on rotation, not purely on length</li>
</ul>
</li>
<li>Must have access_token_expires_at and refresh_token_expires at columns (both datetime, and keep them as UTC)
<ul>
<li>make sure to have these columns calculated during the creation of the session. Do not think of doing &ldquo;time-math&rdquo; for calculating expiry.
<ul>
<li>Because, you may login with one server, but the next server you have the auth checked might have a different time stamp/zone</li>
</ul>
</li>
</ul>
</li>
<li>access/refresh tokens shall be unique</li>
</ul>
</li>
<li>From the above, it becomes possible to have multiple active sessions for one user.
<ul>
<li>If that is not desired, restrict that at code level, not at DB level</li>
</ul>
</li>
<li>Generate random strings for access token and refresh token
<ul>
<li>keep them URLsafe (you&rsquo;ll thank me when you have a mobile app)</li>
<li>Keep them about 256 char long
<ul>
<li>no longer</li>
<li>no shorter</li>
</ul>
</li>
</ul>
</li>
<li>Make access_expiry in a few minutes, and refresh_expiry in a few days</li>
<li>Standard auth is having authorisation header
<ul>
<li><code>Authorisation: Bearer &lt;access-token&gt;</code></li>
</ul>
</li>
<li>Refresh token will require
<ul>
<li><code>Authorisation: Bearer &lt;refresh-token&gt;</code></li>
</ul>
</li>
<li>Deal with Auth always in a middleware and keep the logged in user, or the session found by looking up the access_token (or refresh_token) in the sessions table</li>
<li>On refresh, delete the current session object, and create a new one with new
<ul>
<li>access_token, and new expiry in a few minutes</li>
<li>refresh_token, with new expiry in a few days</li>
</ul>
</li>
<li>Disallow refresh if the refresh token is already expired</li>
<li>So, if a user logs in and is inactive for a few days, the refresh token expires, and they will have to login fresh again</li>
<li>But as long as the user does a &ldquo;refresh&rdquo; before the refresh-token is expired, they will have sessions alive always.</li>
</ul>
</li>
</ul>

    
  </article>
  <div class="paginator">
    
    <a></a>
    
    
    <a class="link" href="https://codicles.org/post/auth-session-tokens-refresh-etc/">next ‚Üí</a>
    
  </div>
  <div class="comment">
    
    
    
    
    
    
  </div>
  
</main>

    <footer id="footer">
  <div>
    <span>¬© 2019</span> - <span>2025</span>
  </div>

  <div>
    <span>Powered by </span>
    <a class="link" href="https://gohugo.io/">Hugo</a>
    <span> üç¶ Theme </span>
    <a class="link" href="https://github.com/queensferryme/hugo-theme-texify">TeXify</a>
  </div>

  <div class="footnote">
    <span>        Follow me on <a class=link href=https://github.com/sillyfellow>GitHub</a>,
        <a class=link href=https://twitter.com/sadanandeep>Twitter</a> or
        <a class=link href=/index.xml>RSS</a> |
        <a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a>
        </span>
  </div>
</footer>

  </div>

  
  
  <link media="screen" rel="stylesheet" href="https://codicles.org/css/custom.css" />
  

  
  
  <script src="https://codicles.org/js/custom.js"></script>
  

</body>

</html>
